# Kgen

Kgen is a protoc plugin for creating client libraries from protocol buffer definitions (version 3).

## Examples

You can find some examples, using Google Cloud APIs, in the [examples directory](examples/README.md).

## Getting Started

You can use Kgen through the command line or with Gradle. Using Gradle is simplier in most
cases, so we'll start there.

### Gradle

  1. Write your API using proto3 as described in the [Language Guide](https://developers.google.com/protocol-buffers/docs/proto).
  2. Put all of your `.proto` files in `app/src/main/proto` (Android) or `src/main/proto` (non-Android).
  3. Configure your application's `build.gradle` as shown below:
  
      *Note* the following example is for an Android application, but the process is nearly 
      identical for a standalone Kotlin application.
      
      ```groovy
      plugins {
          id "com.google.protobuf" version "0.8.5"
      }
      
      // or the java plugin if your not making an Android app
      apply plugin: 'com.android.application'
      apply plugin: 'kotlin-android'
      apply plugin: 'kotlin-android-extensions'
      
      dependencies {
          // ...
          
          // for http/2 gRPC based clients (recommended)
          implementation 'com.google.kgax:kgax-grpc:0.1.0'
          
          // if you prefer to use http/1 use this instead (coming soon)
          // implementation ...
      }
      
      // compile proto and generate your client library
      protobuf {
          // set the version of protobuf compiler to use
          protoc {
              artifact = 'com.google.protobuf:protoc:3.0.0'
          }
          // set the version of the code generators to use
          plugins {
              javalite {
                  artifact = 'com.google.protobuf:protoc-gen-javalite:3.0.0'
              }
              grpc {
                  artifact = 'io.grpc:protoc-gen-grpc-java:1.10.0'
              }
              client {
                  artifact = 'com.google.api:kotlin-client-generator:0.1.0:core@jar'
              }
          }
          // run the code generators
          generateProtoTasks {
              all().each { task ->
                  task.builtins {
                      // java artifacts are generated by default, so delete them
                      // the 'javalite' plugin will generate the files we need instead
                      remove java
                  }
                  task.plugins {
                      // this generates the protocol buffer message types
                      // which include the inputs and outputs of your API
                      javalite {}
                      // this generates a low-level gRPC client for the service defined in your API
                      grpc {
                          option 'lite'
                      }
                      // this generates your client library!
                      client {
                          // TODO: these options will change
                          // for now we have to tell the plugin where the protos are
                          option "source_directory=${projectDir}/src/main/proto"
                      }
                  }
              }
          }
      }
      ```
      
  4. Build your application with gradle:
        
        ```bash
              $ ./gradlew build
        ```

  5. Enjoy your new client library! The generated source code will available on the classpath
     for your application to use, and you can find it at `app/build/generated/source/proto`
     (Android) or `build/generated/source/proto` (standalone application).
     
### Command Line

Coming soon!

## Contributing

Contributions to this library are always welcome and highly encouraged.

See the [CONTRIBUTING](CONTRIBUTING.md) documentation for more information on how to get started.

## Versioning

This library is currently a *preview* with no guarantees of stability or support. Please get involved and let us know
if you find it useful and we'll work towards a stable version.

## Disclaimer

This is not an official Google product.
